---
---

<script is:inline>
  function initCodeCopy() {
    document.querySelectorAll('pre').forEach((pre) => {
      // Skip if already has copy button
      if (pre.querySelector('.copy-button')) return;

      // Create wrapper
      const wrapper = document.createElement('div');
      wrapper.className = 'relative group';
      pre.parentNode.insertBefore(wrapper, pre);
      wrapper.appendChild(pre);

      // Create copy button
      const button = document.createElement('button');
      button.className = 'copy-button absolute top-2 right-2 p-2 rounded-lg bg-gray-700/50 hover:bg-gray-700 text-gray-300 hover:text-white opacity-0 group-hover:opacity-100 transition-all duration-200';
      button.innerHTML = `
        <svg class="w-4 h-4 copy-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
        </svg>
        <svg class="w-4 h-4 check-icon hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
        </svg>
      `;
      button.title = '복사';
      wrapper.appendChild(button);

      button.addEventListener('click', async () => {
        const code = pre.querySelector('code');
        const text = code ? code.textContent : pre.textContent;

        try {
          await navigator.clipboard.writeText(text);

          // Show check icon
          button.querySelector('.copy-icon').classList.add('hidden');
          button.querySelector('.check-icon').classList.remove('hidden');
          button.classList.add('bg-green-600', 'hover:bg-green-600');

          setTimeout(() => {
            button.querySelector('.copy-icon').classList.remove('hidden');
            button.querySelector('.check-icon').classList.add('hidden');
            button.classList.remove('bg-green-600', 'hover:bg-green-600');
          }, 2000);
        } catch (err) {
          console.error('Failed to copy:', err);
        }
      });
    });
  }

  initCodeCopy();
  document.addEventListener('astro:after-swap', initCodeCopy);
</script>

---
const repo = "kyun2da/playground";
const repoId = "R_kgDOHbjrmw";
const category = "General";
const categoryId = "DIC_kwDOHbjrm84CRXte";
---

<div id="giscus-container" class="giscus mt-8"></div>

<script define:vars={{ repo, repoId, category, categoryId }}>
  function loadGiscus() {
    const container = document.getElementById('giscus-container');
    if (!container) return;

    // Clear existing content
    container.innerHTML = '';

    const theme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';

    const script = document.createElement('script');
    script.src = 'https://giscus.app/client.js';
    script.setAttribute('data-repo', repo);
    script.setAttribute('data-repo-id', repoId);
    script.setAttribute('data-category', category);
    script.setAttribute('data-category-id', categoryId);
    script.setAttribute('data-mapping', 'pathname');
    script.setAttribute('data-strict', '0');
    script.setAttribute('data-reactions-enabled', '1');
    script.setAttribute('data-emit-metadata', '0');
    script.setAttribute('data-input-position', 'top');
    script.setAttribute('data-theme', theme);
    script.setAttribute('data-lang', 'ko');
    script.crossOrigin = 'anonymous';
    script.async = true;

    container.appendChild(script);
  }

  // Load Giscus on page load
  loadGiscus();

  // Reload on View Transitions
  document.addEventListener('astro:after-swap', loadGiscus);

  // Update theme when dark mode changes
  const observer = new MutationObserver(() => {
    const iframe = document.querySelector('iframe.giscus-frame');
    if (iframe) {
      const theme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
      iframe.contentWindow?.postMessage(
        { giscus: { setConfig: { theme } } },
        'https://giscus.app'
      );
    }
  });

  observer.observe(document.documentElement, {
    attributes: true,
    attributeFilter: ['class']
  });
</script>

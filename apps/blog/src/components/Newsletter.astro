---
---

<div class="newsletter-widget bg-gradient-to-br from-blue-50 to-purple-50 dark:from-blue-950/30 dark:to-purple-950/30 rounded-xl p-6 border">
  <div class="text-center mb-4">
    <h3 class="text-lg font-bold mb-2">ë‰´ìŠ¤ë ˆí„° êµ¬ë…</h3>
    <p class="text-sm text-muted-foreground">ìƒˆ ê¸€ì´ ì˜¬ë¼ì˜¤ë©´ ì´ë©”ì¼ë¡œ ì•Œë ¤ë“œë ¤ìš”</p>
  </div>

  <form id="newsletter-form" class="flex flex-col sm:flex-row gap-2">
    <input
      type="email"
      id="newsletter-email"
      placeholder="ì´ë©”ì¼ ì£¼ì†Œ"
      required
      class="flex-1 px-4 py-2 rounded-lg border bg-background focus:outline-none focus:ring-2 focus:ring-blue-500"
    />
    <button
      type="submit"
      class="px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors font-medium whitespace-nowrap"
    >
      êµ¬ë…í•˜ê¸°
    </button>
  </form>

  <div id="newsletter-message" class="hidden mt-3 text-center text-sm"></div>

  <p class="text-xs text-muted-foreground text-center mt-3">
    ìŠ¤íŒ¸ ì—†ì´, ì–¸ì œë“  êµ¬ë… ì·¨ì†Œ ê°€ëŠ¥
  </p>
</div>

<script is:inline>
  function initNewsletter() {
    const form = document.getElementById('newsletter-form');
    const emailInput = document.getElementById('newsletter-email');
    const messageEl = document.getElementById('newsletter-message');

    if (!form) return;

    form.onsubmit = async (e) => {
      e.preventDefault();

      const email = emailInput.value;
      const button = form.querySelector('button');
      const originalText = button.textContent;

      button.textContent = 'ì²˜ë¦¬ ì¤‘...';
      button.disabled = true;

      try {
        const res = await fetch('/api/subscribe', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email }),
        });

        const data = await res.json();

        if (res.ok) {
          showMessage('êµ¬ë…í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤! ğŸ‰', 'success');
          emailInput.value = '';
        } else {
          showMessage(data.error || 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'warning');
        }
      } catch (error) {
        showMessage('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
      }

      button.textContent = originalText;
      button.disabled = false;
    };

    function showMessage(text, type) {
      messageEl.textContent = text;
      messageEl.classList.remove('hidden', 'text-green-600', 'text-yellow-600', 'text-red-600');

      if (type === 'success') messageEl.classList.add('text-green-600');
      else if (type === 'warning') messageEl.classList.add('text-yellow-600');
      else messageEl.classList.add('text-red-600');

      setTimeout(() => messageEl.classList.add('hidden'), 5000);
    }
  }

  initNewsletter();
  document.addEventListener('astro:after-swap', initNewsletter);
</script>

---
---

<div id="reading-streak" class="hidden fixed bottom-8 left-1/2 -translate-x-1/2 z-50">
  <div class="bg-gradient-to-r from-orange-500 to-red-500 text-white px-6 py-3 rounded-full shadow-lg flex items-center gap-3 animate-bounce-in">
    <span class="text-2xl">üî•</span>
    <div>
      <div class="font-bold text-sm streak-count">3Ïùº Ïó∞ÏÜç Î∞©Î¨∏!</div>
      <div class="text-xs opacity-90">Íæ∏Ï§ÄÌûà ÏùΩÍ≥† Í≥ÑÏãúÎÑ§Ïöî!</div>
    </div>
  </div>
</div>

<style>
  @keyframes bounce-in {
    0% { transform: translateX(-50%) translateY(100px); opacity: 0; }
    50% { transform: translateX(-50%) translateY(-10px); }
    100% { transform: translateX(-50%) translateY(0); opacity: 1; }
  }
  .animate-bounce-in {
    animation: bounce-in 0.5s ease-out;
  }
</style>

<script is:inline>
  (function() {
    const STREAK_KEY = 'reading-streak';
    const LAST_VISIT_KEY = 'last-visit-date';

    function getToday() {
      return new Date().toISOString().split('T')[0];
    }

    function checkStreak() {
      const today = getToday();
      const lastVisit = localStorage.getItem(LAST_VISIT_KEY);
      let streak = parseInt(localStorage.getItem(STREAK_KEY) || '0', 10);

      if (!lastVisit) {
        // First visit
        streak = 1;
      } else if (lastVisit === today) {
        // Already visited today
        return streak;
      } else {
        const lastDate = new Date(lastVisit);
        const todayDate = new Date(today);
        const diffDays = Math.floor((todayDate - lastDate) / (1000 * 60 * 60 * 24));

        if (diffDays === 1) {
          // Consecutive day
          streak++;
        } else {
          // Streak broken
          streak = 1;
        }
      }

      localStorage.setItem(STREAK_KEY, streak.toString());
      localStorage.setItem(LAST_VISIT_KEY, today);

      return streak;
    }

    function showStreakNotification(streak) {
      if (streak < 2) return;

      const container = document.getElementById('reading-streak');
      if (!container) return;

      const countEl = container.querySelector('.streak-count');
      if (countEl) {
        const messages = {
          2: '2Ïùº Ïó∞ÏÜç Î∞©Î¨∏!',
          3: '3Ïùº Ïó∞ÏÜç Î∞©Î¨∏! üî•',
          7: 'ÏùºÏ£ºÏùº Ïó∞ÏÜç! ÎåÄÎã®Ìï¥Ïöî! üåü',
          14: '2Ï£º Ïó∞ÏÜç! Ïó¥Ï†ï Í∞ÄÎìù! üí™',
          30: 'Ìïú Îã¨ Ïó∞ÏÜç! ÏßÑÏ†ïÌïú ÎèÖÏûê! üëë',
        };

        let message = `${streak}Ïùº Ïó∞ÏÜç Î∞©Î¨∏!`;
        for (const [days, msg] of Object.entries(messages)) {
          if (streak >= parseInt(days)) message = msg;
        }
        countEl.textContent = message;
      }

      container.classList.remove('hidden');

      setTimeout(() => {
        container.classList.add('hidden');
      }, 5000);
    }

    const streak = checkStreak();
    // Only show notification for streaks of 2+ days, and only once per session
    const shownThisSession = sessionStorage.getItem('streak-shown');
    if (streak >= 2 && !shownThisSession) {
      setTimeout(() => showStreakNotification(streak), 2000);
      sessionStorage.setItem('streak-shown', 'true');
    }
  })();
</script>

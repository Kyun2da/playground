---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import ContentCard from '../../components/ContentCard.astro';

const posts = await getCollection('posts', ({ data }) => !data.draft);
const sortedPosts = posts.sort((a, b) =>
  new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
);
const allTags = [...new Set(posts.flatMap((post) => post.data.categories))].sort();

function getPostCountByTag(tag: string): number {
  return posts.filter((post) => post.data.categories.includes(tag)).length;
}
---

<BaseLayout title="Tags">
  <div class="container py-8">
    <div class="max-w-3xl mx-auto">
      <h1 class="text-3xl font-bold mb-8 text-center">Tags</h1>

      <div class="flex flex-wrap justify-center gap-3 mb-12">
        {allTags.map((tag) => (
          <a
            href={`/tags/${tag}`}
            class="inline-flex items-center gap-2 rounded-full bg-muted px-4 py-2 text-sm font-medium text-muted-foreground no-underline hover:bg-accent transition-colors"
          >
            {tag}
            <span class="bg-background rounded-full px-2 py-0.5 text-xs">
              {getPostCountByTag(tag)}
            </span>
          </a>
        ))}
      </div>

      <h2 class="text-2xl font-bold mb-6">모든 글</h2>
      <div class="space-y-6">
        {sortedPosts.map((post) => (
          <ContentCard post={post} />
        ))}
      </div>
    </div>
  </div>
</BaseLayout>
